<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<meta charset="UTF-8">
<title>/user/edit.html</title>
<th:block th:insert="/include/resource :: bootstrap"></th:block>
</head>
<body>
	<div class="container">
		<h1>가입정보 수정 양식</h1>
		<form th:action="@{/user/update}" method="post"
			enctype="multipart/form-data"
			class="p-4 border rounded shadow-sm bg-light">

			<!-- 아이디 -->
			<div class="mb-3">
				<label for="userName" class="form-label">아이디</label> <input
					type="text" class="form-control" id="userName" name="userName"
					th:value="${dto.userName}" readonly>
			</div>

			<!-- 이메일 -->
			<div class="mb-3">
				<label for="email" class="form-label">이메일</label> <input
					type="email" class="form-control" id="email" name="email"
					th:value="${dto.email}" placeholder="이메일을 입력하세요">
			</div>

			<!-- 프로필 이미지 -->
			<div class="mb-3">
				<label class="form-label d-block">프로필 이미지</label>
				<div class="text-center mb-2">
					<a href="javascript:" id="profileLink"> <!-- 기본 아이콘 --> <i
						th:if="${dto.profileImage == null}"
						class="bi bi-person-circle text-secondary"
						style="font-size: 100px;"></i> <!-- 업로드 된 이미지 --> <img
						th:unless="${dto.profileImage == null}"
						th:src="@{/upload/{name}(name=${dto.profileImage})}"
						class="rounded-circle border"
						style="width: 100px; height: 100px; object-fit: cover;">
					</a>
				</div>
				<input type="file" class="form-control d-none" name="profileFile"
					accept="image/*">
				<div class="form-text">클릭해서 프로필 이미지를 변경하세요.</div>
			</div>

			<!-- 버튼 영역 -->
			<div class="d-flex justify-content-between">
				<button type="submit" class="btn btn-primary">수정 확인</button>
				<button type="reset" class="btn btn-outline-secondary">취소</button>
			</div>
		</form>


	</div>
	<script>
		//이미지를 감싸고 있는 링크를 클릭했을때
		document.querySelector("#profileLink").addEventListener("click", ()=>{
			//input type="file" 을 강제로 클릭
			document.querySelector("input[name=profileFile]").click();
		});
	
		// input 요소중에 name 속성의 값이 profileImage 인 요소를 선택해서 이벤트 리스너 함수 등록
		document.querySelector("input[name=profileFile]").addEventListener("change", (e)=>{
			//선택한 파일을 배열로 얻어내기 
			const files = e.target.files;
			//FileReader 객체를 생성해서 
            const reader=new FileReader();
			//배열의 0 번방에 있는 파일 객체를 읽어들이고 
            reader.readAsDataURL(files[0]);
			//다 읽었을때 실행할 함수 등록
            reader.onload = ()=>{
            	//읽은 데이터를 이용해서 img 요소를 만들 준비를 한다.
            	const img=`<img src="${reader.result}" 
            		style="width:100px;height:100px;border-radius:50%">`;
            	// img 마크업 형식의 문자열을 실제로 HTML 로 해석이 되게끔 a 요소안에 넣기
            	document.querySelector("#profileLink").innerHTML = img;
            };
		});
	</script>
</body>
</html>